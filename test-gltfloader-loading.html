<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLTFLoader Loading Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>GLTFLoader Loading Diagnostic</h1>
        
        <div id="results"></div>
        
        <h2>Instructions</h2>
        <ol>
            <li>Open your WordPress configurator page</li>
            <li>Open browser console (F12)</li>
            <li>Copy and paste the diagnostic script below</li>
            <li>Check the results</li>
        </ol>
        
        <h2>Diagnostic Script</h2>
        <pre>
// GLTFLoader Diagnostic Script
console.log('=== GLTFLoader Diagnostic ===');

// Check THREE.js
console.log('1. THREE.js loaded:', typeof THREE !== 'undefined');
if (typeof THREE !== 'undefined') {
    console.log('   THREE version:', THREE.REVISION);
}

// Check for GLTFLoader in different locations
console.log('2. THREE.GLTFLoader:', typeof THREE !== 'undefined' && typeof THREE.GLTFLoader !== 'undefined');
console.log('3. window.GLTFLoader:', typeof window.GLTFLoader !== 'undefined');

// List all THREE properties containing 'GLTF' or 'Loader'
if (typeof THREE !== 'undefined') {
    const loaderProps = Object.keys(THREE).filter(key => 
        key.includes('Loader') || key.includes('GLTF')
    );
    console.log('4. THREE properties with Loader/GLTF:', loaderProps);
}

// Check script tags
const scripts = Array.from(document.querySelectorAll('script[src]'));
const gltfScript = scripts.find(s => s.src.includes('GLTFLoader'));
console.log('5. GLTFLoader script tag found:', !!gltfScript);
if (gltfScript) {
    console.log('   Script src:', gltfScript.src);
    console.log('   Script loaded:', gltfScript.readyState || 'unknown');
}

// Check all loaded scripts
const allScripts = scripts.map(s => ({
    src: s.src.split('/').pop(),
    loaded: s.readyState || 'loaded'
}));
console.log('6. All scripts:', allScripts);

// Try to create GLTFLoader
try {
    if (typeof THREE !== 'undefined' && typeof THREE.GLTFLoader !== 'undefined') {
        const loader = new THREE.GLTFLoader();
        console.log('7. GLTFLoader instance created:', !!loader);
    } else {
        console.log('7. Cannot create GLTFLoader - not available');
    }
} catch (e) {
    console.log('7. Error creating GLTFLoader:', e.message);
}

console.log('=== End Diagnostic ===');
        </pre>
        
        <h2>Common Issues & Solutions</h2>
        
        <div class="info">
            <h3>Issue 1: Script Not Loading</h3>
            <p><strong>Symptom:</strong> GLTFLoader script tag not found</p>
            <p><strong>Solution:</strong> Check that the file exists at the correct path and WordPress is enqueuing it</p>
            <pre>// Check file exists
wp-content/plugins/blasti-configurator/assets/js/GLTFLoader.js</pre>
        </div>
        
        <div class="info">
            <h3>Issue 2: Script Loading Order</h3>
            <p><strong>Symptom:</strong> THREE is undefined when GLTFLoader loads</p>
            <p><strong>Solution:</strong> Ensure THREE.js loads before GLTFLoader</p>
            <pre>// In includes/class-main.php
wp_enqueue_script('threejs-gltf-loader', ..., 
    array('threejs'), // Dependency on THREE.js
    ...
);</pre>
        </div>
        
        <div class="info">
            <h3>Issue 3: Timing Issue</h3>
            <p><strong>Symptom:</strong> GLTFLoader not available when configurator initializes</p>
            <p><strong>Solution:</strong> Wait for all scripts to load before initializing</p>
        </div>
        
        <h2>Quick Fix</h2>
        <p>If GLTFLoader is not loading, try this temporary workaround in browser console:</p>
        <pre>
// Force reload GLTFLoader
const script = document.createElement('script');
script.src = '/wordpress/wp-content/plugins/blasti-configurator/assets/js/GLTFLoader.js';
script.onload = function() {
    console.log('GLTFLoader manually loaded');
    console.log('THREE.GLTFLoader available:', typeof THREE.GLTFLoader !== 'undefined');
    
    // Reinitialize configurator
    if (typeof BlastiConfigurator !== 'undefined') {
        BlastiConfigurator.initializeModelLoader();
    }
};
document.head.appendChild(script);
        </pre>
    </div>
    
    <script>
        // Run diagnostic automatically
        const results = document.getElementById('results');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        // This page doesn't have THREE.js loaded, so we just show instructions
        addResult('This is a diagnostic page. Please run the diagnostic script on your actual configurator page.', 'info');
        addResult('Open your configurator page and check the browser console for script loading order.', 'info');
    </script>
</body>
</html>
